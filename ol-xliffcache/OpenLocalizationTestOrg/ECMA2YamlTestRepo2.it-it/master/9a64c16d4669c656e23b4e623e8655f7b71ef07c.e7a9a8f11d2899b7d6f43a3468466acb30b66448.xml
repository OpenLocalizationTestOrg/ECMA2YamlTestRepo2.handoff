{"nodes":[{"pos":[594,802],"content":"Processes session tokens by using signing and encryption keys specified in the ASP.NET <bpt id=\"p1\">&lt;xref uid=\"langword_csharp_&amp;lt;machineKey&amp;gt;\" name=\"&amp;lt;machineKey&amp;gt;\" href=\"\"&gt;</bpt><ept id=\"p1\">&lt;/xref&gt;</ept> element in a configuration file.","needQuote":true,"needEscape":true,"source":"Processes session tokens by using signing and encryption keys specified in the ASP.NET <xref uid=\"langword_csharp_&lt;machineKey&gt;\" name=\"&lt;machineKey&gt;\" href=\"\"></xref> element in a configuration file."},{"pos":[815,2526],"content":"By default, the <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler> class uses the <xref:System.IdentityModel.ProtectedDataCookieTransform> class, which uses the Data Protection API (DPAPI), to protect the session token. The DPAPI provides protection by using the user or machine credentials and stores the key data in the user profile. This means that a session token signed and encrypted on one computer cannot be validated or decrypted on a different computer.       By contrast, the MachineKeySessionSecurityTokenHandler class uses the <xref:System.IdentityModel.Services.MachineKeyTransform> class, which protects the session cookie data by using the cryptographic material specified in the `<machineKey>` element in the configuration file. This means that the same keys (and session tokens) can be used across multiple computers. This is particularly important when an application is deployed in a web farm. For more information about how to use Windows Identity Foundation to protect applications that are deployed in a web farm, see [WIF and Web Farms](~/add/includes/ajax-current-ext-md.md).       Configure the application to use the MachineKeySessionSecurityTokenHandler by adding it to the token handler collection. You must first remove the <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler> (or any handler derived from the <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler> class) from the token handler collection if such a handler is present. This is because MachineKeySessionSecurityTokenHandler derives from <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler> and a token handler collection cannot contain multiple handlers of any given type.","needQuote":false,"needEscape":true,"extradata":"MT","nodes":[{"content":"By default, the &lt;xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler&gt; class uses the &lt;xref:System.IdentityModel.ProtectedDataCookieTransform&gt; class, which uses the Data Protection API (DPAPI), to protect the session token.","pos":[0,231],"source":"By default, the <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler> class uses the <xref:System.IdentityModel.ProtectedDataCookieTransform> class, which uses the Data Protection API (DPAPI), to protect the session token."},{"content":"The DPAPI provides protection by using the user or machine credentials and stores the key data in the user profile.","pos":[232,347]},{"content":"This means that a session token signed and encrypted on one computer cannot be validated or decrypted on a different computer.","pos":[348,474]},{"content":"By contrast, the MachineKeySessionSecurityTokenHandler class uses the &lt;xref:System.IdentityModel.Services.MachineKeyTransform&gt; class, which protects the session cookie data by using the cryptographic material specified in the <ph id=\"ph1\">`&lt;machineKey&gt;`</ph> element in the configuration file.","pos":[481,756],"source":"       By contrast, the MachineKeySessionSecurityTokenHandler class uses the <xref:System.IdentityModel.Services.MachineKeyTransform> class, which protects the session cookie data by using the cryptographic material specified in the `<machineKey>` element in the configuration file."},{"content":"This means that the same keys (and session tokens) can be used across multiple computers.","pos":[757,846]},{"content":"This is particularly important when an application is deployed in a web farm.","pos":[847,924]},{"content":"For more information about how to use Windows Identity Foundation to protect applications that are deployed in a web farm, see <bpt id=\"p1\">[</bpt>WIF and Web Farms<ept id=\"p1\">](~/add/includes/ajax-current-ext-md.md)</ept>.","pos":[925,1111],"source":" For more information about how to use Windows Identity Foundation to protect applications that are deployed in a web farm, see [WIF and Web Farms](~/add/includes/ajax-current-ext-md.md)."},{"content":"Configure the application to use the MachineKeySessionSecurityTokenHandler by adding it to the token handler collection.","pos":[1118,1238]},{"content":"You must first remove the &lt;xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler&gt; (or any handler derived from the &lt;xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler&gt; class) from the token handler collection if such a handler is present.","pos":[1239,1494],"source":" You must first remove the <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler> (or any handler derived from the <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler> class) from the token handler collection if such a handler is present."},{"content":"This is because MachineKeySessionSecurityTokenHandler derives from &lt;xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler&gt; and a token handler collection cannot contain multiple handlers of any given type.","pos":[1495,1707],"source":" This is because MachineKeySessionSecurityTokenHandler derives from <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler> and a token handler collection cannot contain multiple handlers of any given type."}]},{"pos":[8713,8849],"content":"Initializes a new instance of the <bpt id=\"p1\">&lt;xref href=\"System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler\"&gt;</bpt><ept id=\"p1\">&lt;/xref&gt;</ept> class.","needQuote":true,"needEscape":true,"source":"Initializes a new instance of the <xref href=\"System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler\"></xref> class."},{"pos":[9738,9920],"content":"Initializes a new instance of the <bpt id=\"p1\">&lt;xref href=\"System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler\"&gt;</bpt><ept id=\"p1\">&lt;/xref&gt;</ept> class that has the specified default token lifetime.","needQuote":true,"needEscape":true,"source":"Initializes a new instance of the <xref href=\"System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler\"></xref> class that has the specified default token lifetime."},{"pos":[10102,10135],"content":"The default lifetime for a token.","needQuote":true,"needEscape":true,"nodes":[{"content":"The default lifetime for a token.","pos":[0,33]}]},{"pos":[10354,10462],"content":"<ph id=\"ph1\">&lt;code&gt;tokenLifetime&lt;/code&gt;</ph> is shorter than or equal to <ph id=\"ph2\">&amp;lt;</ph>xref:System.TimeSpan?displayProperty=fullName<ph id=\"ph3\">&amp;gt;</ph>","needQuote":true,"needEscape":true,"source":"<code>tokenLifetime</code> is shorter than or equal to &lt;xref:System.TimeSpan?displayProperty=fullName&gt;"}],"content":"### YamlMime:ManagedReference\nitems:\n- uid: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler\n  id: MachineKeySessionSecurityTokenHandler\n  children:\n  - System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler.#ctor\n  - System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler.#ctor(System.TimeSpan)\n  langs:\n  - csharp\n  name: MachineKeySessionSecurityTokenHandler\n  nameWithType: MachineKeySessionSecurityTokenHandler\n  fullName: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler\n  type: Class\n  summary: Processes session tokens by using signing and encryption keys specified in the ASP.NET <xref uid=\"langword_csharp_&lt;machineKey&gt;\" name=\"&lt;machineKey&gt;\" href=\"\"></xref> element in a configuration file.\n  remarks: \"By default, the <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler> class uses the <xref:System.IdentityModel.ProtectedDataCookieTransform> class, which uses the Data Protection API (DPAPI), to protect the session token. The DPAPI provides protection by using the user or machine credentials and stores the key data in the user profile. This means that a session token signed and encrypted on one computer cannot be validated or decrypted on a different computer.  \\n  \\n By contrast, the MachineKeySessionSecurityTokenHandler class uses the <xref:System.IdentityModel.Services.MachineKeyTransform> class, which protects the session cookie data by using the cryptographic material specified in the `<machineKey>` element in the configuration file. This means that the same keys (and session tokens) can be used across multiple computers. This is particularly important when an application is deployed in a web farm. For more information about how to use Windows Identity Foundation to protect applications that are deployed in a web farm, see [WIF and Web Farms](~/add/includes/ajax-current-ext-md.md).  \\n  \\n Configure the application to use the MachineKeySessionSecurityTokenHandler by adding it to the token handler collection. You must first remove the <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler> (or any handler derived from the <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler> class) from the token handler collection if such a handler is present. This is because MachineKeySessionSecurityTokenHandler derives from <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler> and a token handler collection cannot contain multiple handlers of any given type.\"\n  example:\n  - \"The following XML shows how to use the ASP.NET `<machineKey>` element in configuration to explicitly specify signing and encryption keys. The `<machineKey>` element is specified under the `<system.web>` element in a configuration file.  \\n  \\n```xml  \\n<machineKey compatibilityMode=\\\"Framework45\\\" decryptionKey=\\\"CC510D … 8925E6\\\" validationKey=\\\"BEAC8 … 6A4B1DE\\\" />  \\n```  \\n  \\n The following XML shows how to add the MachineKeySessionSecurityTokenHandler to a token handler collection. The default <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler> is first removed from the collection. Token handlers are configured under the [\\\\&lt;securityTokenHandlers\\\\&gt;](../Topic/%3CsecurityTokenHandlers%3E.md) element.  \\n  \\n```xml  \\n<securityTokenHandlers>  \\n  <remove type=\\\"System.IdentityModel.Tokens.SessionSecurityTokenHandler, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\\\" />  \\n  <add type=\\\"System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\\\" />  \\n</securityTokenHandlers>  \\n```\"\n  syntax:\n    content: 'public class MachineKeySessionSecurityTokenHandler : System.IdentityModel.Tokens.SessionSecurityTokenHandler'\n  inheritance:\n  - System.Object\n  - System.IdentityModel.Tokens.SecurityTokenHandler\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler\n  implements: []\n  inheritedMembers:\n  - System.IdentityModel.Tokens.SecurityTokenHandler.CanReadKeyIdentifierClause(System.Xml.XmlReader)\n  - System.IdentityModel.Tokens.SecurityTokenHandler.CanReadToken(System.String)\n  - System.IdentityModel.Tokens.SecurityTokenHandler.CanWriteKeyIdentifierClause(System.IdentityModel.Tokens.SecurityKeyIdentifierClause)\n  - System.IdentityModel.Tokens.SecurityTokenHandler.Configuration\n  - System.IdentityModel.Tokens.SecurityTokenHandler.ContainingCollection\n  - System.IdentityModel.Tokens.SecurityTokenHandler.CreateSecurityTokenReference(System.IdentityModel.Tokens.SecurityToken,System.Boolean)\n  - System.IdentityModel.Tokens.SecurityTokenHandler.DetectReplayedToken(System.IdentityModel.Tokens.SecurityToken)\n  - System.IdentityModel.Tokens.SecurityTokenHandler.ReadKeyIdentifierClause(System.Xml.XmlReader)\n  - System.IdentityModel.Tokens.SecurityTokenHandler.ReadToken(System.String)\n  - System.IdentityModel.Tokens.SecurityTokenHandler.TraceTokenValidationFailure(System.IdentityModel.Tokens.SecurityToken,System.String)\n  - System.IdentityModel.Tokens.SecurityTokenHandler.TraceTokenValidationSuccess(System.IdentityModel.Tokens.SecurityToken)\n  - System.IdentityModel.Tokens.SecurityTokenHandler.WriteKeyIdentifierClause(System.Xml.XmlWriter,System.IdentityModel.Tokens.SecurityKeyIdentifierClause)\n  - System.IdentityModel.Tokens.SecurityTokenHandler.WriteToken(System.IdentityModel.Tokens.SecurityToken)\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.ApplyTransforms(System.Byte[],System.Boolean)\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.CanReadToken(System.Xml.XmlReader)\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.CanValidateToken\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.CanWriteToken\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.CookieElementName\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.CookieNamespace\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.CreateSessionSecurityToken(System.Security.Claims.ClaimsPrincipal,System.String,System.String,System.DateTime,System.DateTime)\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.CreateToken(System.IdentityModel.Tokens.SecurityTokenDescriptor)\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.DefaultCookieTransforms\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.DefaultLifetime\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.DefaultTokenLifetime\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.GetTokenTypeIdentifiers\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.LoadCustomConfiguration(System.Xml.XmlNodeList)\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.ReadToken(System.Byte[],System.IdentityModel.Selectors.SecurityTokenResolver)\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.ReadToken(System.Xml.XmlReader)\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.ReadToken(System.Xml.XmlReader,System.IdentityModel.Selectors.SecurityTokenResolver)\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.SetTransforms(System.Collections.Generic.IEnumerable{System.IdentityModel.CookieTransform})\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.TokenLifetime\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.TokenType\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.Transforms\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.ValidateSession(System.IdentityModel.Tokens.SessionSecurityToken)\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.ValidateToken(System.IdentityModel.Tokens.SecurityToken)\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.ValidateToken(System.IdentityModel.Tokens.SessionSecurityToken,System.String)\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.WriteToken(System.IdentityModel.Tokens.SessionSecurityToken)\n  - System.IdentityModel.Tokens.SessionSecurityTokenHandler.WriteToken(System.Xml.XmlWriter,System.IdentityModel.Tokens.SecurityToken)\n  platform:\n  - net462\n- uid: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler.#ctor\n  id: '#ctor'\n  parent: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler\n  langs:\n  - csharp\n  name: MachineKeySessionSecurityTokenHandler()\n  nameWithType: MachineKeySessionSecurityTokenHandler.MachineKeySessionSecurityTokenHandler()\n  fullName: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler.MachineKeySessionSecurityTokenHandler()\n  type: Constructor\n  assemblies:\n  - System.IdentityModel.Services\n  namespace: System.IdentityModel.Services.Tokens\n  summary: Initializes a new instance of the <xref href=\"System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler\"></xref> class.\n  syntax:\n    content: public MachineKeySessionSecurityTokenHandler ();\n    parameters: []\n  overload: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler.#ctor*\n  exceptions: []\n  platform:\n  - net462\n- uid: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler.#ctor(System.TimeSpan)\n  id: '#ctor(System.TimeSpan)'\n  parent: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler\n  langs:\n  - csharp\n  name: MachineKeySessionSecurityTokenHandler(TimeSpan)\n  nameWithType: MachineKeySessionSecurityTokenHandler.MachineKeySessionSecurityTokenHandler(TimeSpan)\n  fullName: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler.MachineKeySessionSecurityTokenHandler(TimeSpan)\n  type: Constructor\n  assemblies:\n  - System.IdentityModel.Services\n  namespace: System.IdentityModel.Services.Tokens\n  summary: Initializes a new instance of the <xref href=\"System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler\"></xref> class that has the specified default token lifetime.\n  syntax:\n    content: public MachineKeySessionSecurityTokenHandler (TimeSpan tokenLifetime);\n    parameters:\n    - id: tokenLifetime\n      type: System.TimeSpan\n      description: The default lifetime for a token.\n  overload: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler.#ctor*\n  exceptions:\n  - type: System.InvalidOperationException\n    commentId: T:System.InvalidOperationException\n    description: <code>tokenLifetime</code> is shorter than or equal to &lt;xref:System.TimeSpan?displayProperty=fullName&gt;\n  platform:\n  - net462\nreferences:\n- uid: System.IdentityModel.Tokens.SessionSecurityTokenHandler\n  isExternal: false\n  name: System.IdentityModel.Tokens.SessionSecurityTokenHandler\n- uid: System.InvalidOperationException\n  isExternal: true\n  name: System.InvalidOperationException\n- uid: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler.#ctor\n  parent: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler\n  isExternal: false\n  name: MachineKeySessionSecurityTokenHandler()\n  nameWithType: MachineKeySessionSecurityTokenHandler.MachineKeySessionSecurityTokenHandler()\n  fullName: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler.MachineKeySessionSecurityTokenHandler()\n- uid: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler.#ctor(System.TimeSpan)\n  parent: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler\n  isExternal: false\n  name: MachineKeySessionSecurityTokenHandler(TimeSpan)\n  nameWithType: MachineKeySessionSecurityTokenHandler.MachineKeySessionSecurityTokenHandler(TimeSpan)\n  fullName: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler.MachineKeySessionSecurityTokenHandler(TimeSpan)\n- uid: System.TimeSpan\n  parent: System\n  isExternal: true\n  name: TimeSpan\n  nameWithType: TimeSpan\n  fullName: System.TimeSpan\n- uid: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler.#ctor*\n  parent: System.IdentityModel.Services.Tokens.MachineKeySessionSecurityTokenHandler\n  isExternal: false\n  name: MachineKeySessionSecurityTokenHandler\n  nameWithType: MachineKeySessionSecurityTokenHandler.MachineKeySessionSecurityTokenHandler\n"}